<!doctype html>
<meta charset="utf-8">
<title>Search</title>
<style>
  body{max-width:680px;margin:80px auto;font-family:system-ui,Segoe UI,Roboto,Arial;text-align:center}
  form{display:flex;gap:.5rem;justify-content:center;margin-bottom:2rem}
  input[type=text]{flex:1;min-width:300px;padding:.6rem;border:1px solid #ddd;border-radius:999px;text-align:left}
  button{padding:.6rem 1rem;border:1px solid #ddd;border-radius:999px;background:#f7f7f7;cursor:pointer}
  .hit{text-align:left;margin:1rem 0}
  .hit-head{display:flex;align-items:center;gap:.4rem}
  .hit-favicon{width:16px;height:16px;border-radius:4px;flex-shrink:0}
  .url{color:#555;font-size:.9rem;word-break:break-all}
  mark{background:#fffa8b}
  .meta{color:#666;font-size:.9rem;margin:.5rem 0;text-align:left}
  .pagination{margin-top:1rem;text-align:center}
  .pagination a{margin:0 .5rem;text-decoration:none;color:#00f}
  .pagination span{margin:0 .5rem;color:#555}
</style>

<h1>Search</h1>

<form method="get" action="/">
  <input name="q" value="{{ q or '' }}" placeholder="検索ワード" autofocus>
  <button>検索</button>
</form>

{% if q is not none %}
  {% if result and result.hits %}
    <p class="meta">約 {{ "{:,}".format(result.total) }} 件</p>
    {% for r in result.hits %}
      <div class="hit">
        <div class="hit-head">
          <img
            class="hit-favicon"
            src="https://www.google.com/s2/favicons?sz=16&domain_url={{ r['url'] }}"
            alt=""
            loading="lazy">
          <a href="{{ r['url'] }}" target="_blank" rel="noopener noreferrer">
            {{ r['title'] or '(no title)' }}
          </a>
        </div>
        <div class="url">{{ r['url'] }}</div>
        <div>{{ r['snip']|safe }}</div>
      </div>
    {% endfor %}

    <div class="pagination">
      {% if result.page > 1 %}
        <a href="?q={{ q }}&page={{ result.page-1 }}">« 前へ</a>
      {% endif %}
      <span>ページ {{ result.page }} / {{ result.last_page }}</span>
      {% if result.page < result.last_page %}
        <a href="?q={{ q }}&page={{ result.page+1 }}">次へ »</a>
      {% endif %}
    </div>

  {% else %}
    <p class="meta">結果なし</p>
  {% endif %}
{% endif %}
